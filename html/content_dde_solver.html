<h2>DDE_SOLVER</h2>
<p>
DDE_SOLVER is a Fortran 90 module created by S. Thompson and L. F. Shampine
for solving differential delay equations.  It is described in the article

<ul>
<li>S. Thompson, L.F. Shampine, A friendly Fortran DDE solver,
    <em>Applied Numerical Mathematics</em>, Volume 56, Issues 3-4, 2006,
    pages 503-516, ISSN 0168-9274,
    https://doi.org/10.1016/j.apnum.2005.04.027.</li>
</ul>

</p>
<p>
The source for DDE_SOLVER was originally available from S. Thompson's web
site at Radford University, but that link is no longer working.  An updated
version of DDE_SOLVER is maintained on GitHub at
<a href="https://github.com/WarrenWeckesser/dde_solver">WarrenWeckesser /
dde_solver</a>.  The file <code>dde_solver_m.f90</code> from that site
is the code that VFGEN targets.
</p>
<h3>The VFGEN DDE_SOLVER Command</h3>
<p>
A Fortran 90 file that can be used with the DDE_SOLVER
module is created by the command
<br />
<div class="mypre">$ vfgen dde_solver vector_field_file.vf</div>
</p>
<p>
The command will create the file <span class="tt">[name].f90</span>,
where <span class="tt">[name]</span> is the
name of the vector field defined in <span class="tt">vector_field_file.vf</span>.
</p>
<p>
The vector field must have at least one <b>delay</b> expression.
</p>

<h4>Options</h4>
<table class="options">
<tr>
<td>
<b>demo</b>
</td>
<td>
If the option <b>demo=yes</b> is given, the file <b>[name]_demo.f90</b>
is created. This program uses the default initial conditions and parameter
values to generate a solution to the DDEs.
<br />
<i>Default</i>: <b>demo=no</b>
</td>
</tr>
</table>

<h4>Example 1</h4>
<p>
The Mackey-Glass equation is
$$x'(t) = -bx + \frac{ax(t-\tau)}{1 + x(t-\tau)^{10}}$$
</p>
<p>
Here is the Mackey-Glass vector field file: <a href="example_vf/MackeyGlass.vf">MackeyGlass.vf</a>.
<br>
The files created by
<div class="mypre">$ vfgen dde_solver:demo=yes MackeyGlass.vf</div>
<br>
are
<ul>
<li><a href="example_dde_solver/MackeyGlass.f90">MackeyGlass.f90</a>
<li><a href="example_dde_solver/MackeyGlass_demo.f90">MackeyGlass_demo.f90</a>
</ul>
</p>
<p>
To compile the demonstration program, I will use the <b>gfortran</b> compiler.
</p>
<p>
To compile the DDE_SOLVER module:
<div class="mypre">$ gfortran -c dde_solver_m.f90</div>
</p>
<p>
To compile the demonstration program:
<div class="mypre">$ gfortran MackeyGlass.f90 MackeyGlass_demo.f90 dde_solver_m.o -o MackeyGlass_demo</div>
and to run it:
<div class="mypre">$ ./MackeyGlass_demo > mg.dat</div>
<p>
Here is a plot of the data generated by <span class="tt">MackeyGlass_demo</span>, after the <span class="tt">stoptime</span>
in <span class=="tt">MackeyGlass_demo.f90</span> was changed to 500:
<br />
<center>
<img class="exampleplot" src="example_dde_solver/mg.svg" alt="Plot of x(t)">
</center>
</p>
</p>

<h4>Example 2</h4>
<p>
This example has a state-dependent delay.
The DDE is

$$y'(t) = \frac{y(t) y(\ln(y(t))-1)}{t + 1}$$
$$y(t) = 1, \; t < 0$$

<br />
A vector field file for this system is
<a href="example_vf/sdd.vf">sdd.vf</a>.
We create the Fortran 90 functions and demonstration program with the command
<div class="mypre">$ vfgen dde_solver:demo=yes sdd.vf</div>
This creates the files
<ul>
<li><a href="example_dde_solver/sdd.f90">sdd.f90</a>
<li><a href="example_dde_solver/sdd_demo.f90">sdd_demo.f90</a>
</ul>
In Linux, we compile and run this program with the commands
<div class="mypre">$ gfortran sdd.f90 sdd_demo.f90 dde_solver_m.o -o sdd_demo<br />
$ ./sdd_demo > sdd.dat</div>
Here is a plot of the result.  The data computed by DDE_SOLVER is plotted with
blue dots; the exact solution is the green line.
<center>
<img class="exampleplot" src="example_dde_solver/sdd.svg">
</center>
For reference, the exact solution is

\[
y(t) = 
    \left\{
        \begin{matrix}
        t + 1, & 0 \le t \le e-1 \\
        \exp\left(\frac{t+1}{e}\right), & e-1 \le t \le e^2-1 \\
        \left(\frac{e}{3 - \ln(t+1)}\right)^e, & e^2 - 1 \le t \le e^3 - e^{1-e} - 1 \\
        \end{matrix}
    \right.
\]

The example was taken from "DKLAG6: A Code Based on Continuously Imbedded
Sixth Order Runge-Kutta Methods for the Solution of State Dependent Functional
Differential Equations", by S. P. Corwin, D. Sarafyan, and S. Thompson, and they
give their source of the equation as "Developing a Delay Differential Equation
Solver" by C. A. H. Paul (<i>J. Appl. Num. Math.</i>, Vol. 9, pp. 403-414, 1992).
</p>

<h4>Example 3</h4>
<p>
This is another example with a state-dependent delay.
The DDE is

$$y'(t) = \frac{y\left(y(t)-\sqrt{2}\right)}{2\sqrt{t+1}}$$
$$y(t) = 1, \; t < 0$$

A vector field file for this system is
<a href="example_vf/sddfn.vf">sddfn.vf</a>.
We create the Fortran 90 functions and demonstration program with the command
<div class="mypre">$ vfgen dde_solver:demo=yes sddfn.vf</div>
This creates the files
<ul>
<li><a href="example_dde_solver/sddfn.f90">sddfn.f90</a>
<li><a href="example_dde_solver/sddfn_demo.f90">sddfn_demo.f90</a>
</ul>
In Linux, we compile and run this program with the commands
<div class="mypre">$ gfortran sddfn.f90 sddfn_demo.f90 dde_solver_m.o -o sddfn_demo<br />
$ ./sddfn_demo > sddfn.dat</div>
Here is a plot of the result, after changing the variables in the demo program
to <b>relerr=1D-9</b>, <b>abserr=1D-11</b>, and <b>stoptime=2.0</b>.
The data computed by DDE_SOLVER is plotted with
blue dots; the exact solution is the green line.
<center>
<img class="exampleplot" src="example_dde_solver/sddfn.svg">
</center>
For reference, the exact solution is

$$
y(t) =
    \left\{
    \begin{matrix}
    \sqrt{t + 1}, & 0 \le t \le 1 \\
    \frac{t + 1}{4} + \frac{1}{2} + \left(1 - \frac{\sqrt{2}}{2}\right)\sqrt{t + 1}, & 1 \le t \le 2 \\
    \end{matrix}
    \right.
$$

The example was taken from
"High Order Methods for State-Dependent Delay Differential Equations with Nonsmooth
Solutions", by A. Feldstein and K. W. Neves
(<i>SIAM J. Numer. Anal.</i>, Vol. 21, No. 5., pp. 844-863, October, 1984).
</p>
